<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="ComBbs">

	<typeAlias alias="comBbsVO" type="com.devBoard.comBbs.vo.ComBbsVO"/>

	<resultMap id="comBbsListMap" class="comBbsVO">
		<result property="comBbsSeq" column="COM_BBS_SEQ"/>
		<result property="nttTitle" column="NTT_TITLE"/>
		<result property="nttContent" column="NTT_CONTENT" jdbcType="CLOB"/>
		<result property="prntsNo" column="PRNTS_NO"/>
		<result property="replyLoc" column="REPLY_LOC"/>
		<result property="sortOrder" column="SORT_ORDER"/>
		<result property="useYn2" column="USE_YN2"/>
		<result property="rgstId" column="RGST_ID"/>
		<result property="rgstDt" column="RGST_DT"/>
		<result property="updId" column="UPD_ID"/>
		<result property="updDt" column="UPD_DT"/>
	</resultMap>
	
	<select id="comBbsDAO.selectComBbsList" parameterClass="comBbsVO" resultMap="comBbsListMap">
		/** 게시판 목록을 조회한다. (comBbsDAO.selectComBbsList) **/
		SELECT * FROM ( SELECT ROWNUM RN, TB.* FROM (
		
			SELECT  MAIN.COM_BBS_SEQ
			,       LPAD(' ', LEVEL-1, ' ') || MAIN.NTT_TITLE AS NTT_TITLE
			,       MAIN.NTT_CONTENT 
			,       MAIN.PRNTS_NO    
			,       MAIN.REPLY_LOC   
			,       MAIN.SORT_ORDER  
			,       MAIN.USE_YN2      
			,       MAIN.RGST_ID     
			,       MAIN.RGST_DT     
			,       MAIN.UPD_ID      
			,       MAIN.UPD_DT     
			FROM    SAMPLE MAIN
			WHERE   1 = 1
			AND		MAIN.USE_YN2 = 'Y'
			<isEqual prepend="AND" property="searchCondition" compareValue="1">
				<isNotEmpty property="searchKeyword">
				MAIN.NTT_TITLE LIKE '%' || #searchKeyword# || '%'
				</isNotEmpty>
			</isEqual>
			<isEqual prepend="AND" property="searchCondition" compareValue="0">
				<isNotEmpty property="searchKeyword">
				MAIN.RGST_ID LIKE '%' || #searchKeyword# || '%'
				</isNotEmpty>
			</isEqual>
			<isNotEmpty property="startDate">
				AND		MAIN.RGST_DT BETWEEN TO_DATE(#startDate# || '000000', 'YYYYMMDDHH24MISS') AND TO_DATE(#endDate# || '235959', 'YYYYMMDDHH24MISS') 
			</isNotEmpty>
			START WITH PRNTS_NO = 0                       
			CONNECT BY PRIOR MAIN.COM_BBS_SEQ = MAIN.PRNTS_NO
			ORDER SIBLINGS BY MAIN.RGST_DT DESC, MAIN.SORT_ORDER
					
		) TB ) WHERE RN BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#
	</select>
	
	<select id="comBbsDAO.selectComBbsListCount" parameterClass="comBbsVO" resultClass="java.lang.Integer">
	<![CDATA[
		/** 게시판 목록을 건수를 조회한다. (comBbsDAO.selectComBbsListCount) **/
		SELECT  COUNT(MAIN.COM_BBS_SEQ) AS CNT
		FROM    SAMPLE MAIN
		WHERE	1 = 1
		]]>
		AND		MAIN.USE_YN2 = 'Y'
		<isEqual prepend="AND" property="searchCondition" compareValue="1">
			<isNotEmpty property="searchKeyword">
			MAIN.NTT_TITLE LIKE '%' || #searchKeyword# || '%'
			</isNotEmpty>
		</isEqual>
		<isEqual prepend="AND" property="searchCondition" compareValue="0">
			<isNotEmpty property="searchKeyword">
			MAIN.RGST_ID LIKE '%' || #searchKeyword# || '%'
			</isNotEmpty>
		</isEqual>
		<isNotEmpty property="startDate">
			AND		MAIN.RGST_DT BETWEEN TO_DATE(#startDate# || '000000', 'YYYYMMDDHH24MISS') AND TO_DATE(#endDate# || '235959', 'YYYYMMDDHH24MISS') 
		</isNotEmpty>
	</select>
	
	<select id="comBbsDAO.selectComBbsView" parameterClass="comBbsVO" resultMap="comBbsListMap">
		/** 게시판 상세를 조회한다. (comBbsDAO.selectComBbsView) **/
		SELECT  MAIN.COM_BBS_SEQ
		,		MAIN.NTT_TITLE   
		,		MAIN.NTT_CONTENT 
		,		MAIN.PRNTS_NO    
		,		MAIN.REPLY_LOC   
		,		MAIN.SORT_ORDER  
		,		MAIN.USE_YN2      
		,		MAIN.RGST_ID     
		,		MAIN.RGST_DT     
		,		MAIN.UPD_ID      
		,		MAIN.UPD_DT      
		FROM	SAMPLE MAIN
		WHERE	1 = 1
		AND		MAIN.COM_BBS_SEQ=#comBbsSeq#
		AND		MAIN.USE_YN2 = 'Y'
	</select>
	
	<insert id="comBbsDAO.insertComBbs" parameterClass="comBbsVO">
		<selectKey resultClass="java.lang.Integer" keyProperty="comBbsSeq">
		SELECT COM_BBS_SEQ.NEXTVAL FROM DUAL
		</selectKey>
		
		<![CDATA[
		INSERT INTO SAMPLE (
			   COM_BBS_SEQ       
			  , NTT_TITLE        
			  , NTT_CONTENT      
			  , PRNTS_NO         
			  , REPLY_LOC        
			  , SORT_ORDER       
			  , USE_YN2           
			  , RGST_ID          
			  , RGST_DT          
			  )		
			  VALUES(
			   #comBbsSeq#       
			  , #nttTitle#       
			  , #nttContent:CLOB#     
			  , #prntsNo#        
			  , #replyLoc#       
			  , #comBbsSeq#      
			  , 'Y'              
			  , #rgstId#         
			  , SYSDATE          
			  )
		]]>
	</insert>
	
	<update id="comBbsDAO.updateComBbs" parameterClass="comBbsVO">
		UPDATE SAMPLE
		   SET NTT_TITLE   = #nttTitle#        
			 , NTT_CONTENT = #nttContent#      
			 , RGST_ID     = #rgstId#
			 , UPD_ID      = #updId#           
			 , UPD_DT      = SYSDATE           
		WHERE 1 = 1
		  AND COM_BBS_SEQ = #comBbsSeq#
		  AND USE_YN2 = 'Y'
	</update>

	<delete id="comBbsDAO.deleteComBbs" parameterClass="comBbsVO">
		<![CDATA[
		UPDATE	SAMPLE
		SET		USE_YN2 = 'N' 
		,		UPD_ID = #updId#
		,		UPD_DT = SYSDATE
		WHERE 1 = 1
		AND COM_BBS_SEQ in( SELECT COM_BBS_SEQ
		                            FROM SAMPLE
		                            WHERE 1 = 1
		                          START WITH COM_BBS_SEQ = #comBbsSeq#
		                          CONNECT BY PRIOR COM_BBS_SEQ = PRNTS_NO) 
		AND USE_YN2 = 'Y'
		]]>
	</delete>
</sqlMap>