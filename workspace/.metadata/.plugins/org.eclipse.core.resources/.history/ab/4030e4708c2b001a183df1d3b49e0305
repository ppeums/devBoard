package com.devBoard.common.controller;

import javax.annotation.Resource;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import org.springframework.stereotype.Controller;
import org.springframework.ui.ModelMap;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;

import com.devBoard.common.service.FileService;
import com.devBoard.framework.util.DateUtil;
import com.devBoard.framework.util.FileUtil;
import com.devBoard.framework.view.EgovMapXmlView;
import com.devBoard.framework.vo.FileVO;

import egovframework.rte.psl.dataaccess.util.EgovMap;

/**
 * @Class Name : CommonController.java
 * @Description : 화면 처리를 위한 시스템 공통모듈 Controller
 * @Modification Information @ @ 수정일 수정자 수정내용 @ --------- ---------
 *               ------------------------------- @ 2012.12.11 송제승 최초생성
 * 
 * @author 송제승
 * @since 2012. 12.11
 * @version 1.0
 * @see Copyright (C) by Sinsuldong All right reserved.
 */
@Controller
public class CommonController2 {
	// private final Logger logger = Logger.getLogger(this.getClass());

	/** 첨부파일 처리를 위한 service */
	@Resource(name = "fileService")
	private FileService fileService;

	/**
	 * 달력 팝업을 오픈한다.
	 * 
	 * @param model
	 *            ModelMap
	 * @return JSP 경로
	 * @throws Exception
	 */
	@RequestMapping(value = "/common/openCalendar.do")
	public String openCalendar(ModelMap model) throws Exception {
		return "/common/calendarPop";
	}

	/**
	 * 달력 날짜를 1주일 셋팅한다.
	 * 
	 * @param model
	 *            ModelMap
	 * @return JSP 경로
	 * @throws Exception
	 */
	@RequestMapping(value = "/common/weekCalendar.do")
	public ModelAndView weekCalendar(ModelMap model) throws Exception {

		ModelAndView mav = new ModelAndView(new EgovMapXmlView());

		EgovMap result = new EgovMap();

		result.put("startDate", DateUtil.getDate(-7));
		result.put("endDate", DateUtil.getDate());

		mav.addObject("map", result);

		return mav;
	}

	/**
	 * 달력 날짜를 15일 셋팅한다.
	 * 
	 * @param model
	 *            ModelMap
	 * @return JSP 경로
	 * @throws Exception
	 */
	@RequestMapping(value = "/common/halfMonthCalendar.do")
	public ModelAndView halfMonthCalendar(ModelMap model) throws Exception {

		ModelAndView mav = new ModelAndView(new EgovMapXmlView());

		EgovMap result = new EgovMap();

		result.put("startDate", DateUtil.getDate(-15));
		result.put("endDate", DateUtil.getDate());

		mav.addObject("map", result);

		return mav;
	}

	/**
	 * 달력 날짜를 1개월 셋팅한다.
	 * 
	 * @param model
	 *            ModelMap
	 * @return JSP 경로
	 * @throws Exception
	 */
	@RequestMapping(value = "/common/monthCalendar.do")
	public ModelAndView monthCalendar(ModelMap model) throws Exception {

		ModelAndView mav = new ModelAndView(new EgovMapXmlView());

		EgovMap result = new EgovMap();

		result.put("startDate", DateUtil.getPreviousMonth());
		result.put("endDate", DateUtil.getDate());

		mav.addObject("map", result);

		return mav;
	}

	/**
	 * 달력 날짜를 3개월 셋팅한다.
	 * 
	 * @param model
	 *            ModelMap
	 * @return JSP 경로
	 * @throws Exception
	 */
	@RequestMapping(value = "/common/threeMonthCalendar.do")
	public ModelAndView threeMonthCalendar(ModelMap model) throws Exception {

		ModelAndView mav = new ModelAndView(new EgovMapXmlView());

		EgovMap result = new EgovMap();

		result.put("startDate", DateUtil.getDate(2, null, -3));
		result.put("endDate", DateUtil.getDate());

		mav.addObject("map", result);

		return mav;
	}

	// TODO 공통 - 파일 업로드 및 파일 다운로드를 처리하는 클래스
	/**
	 * 공통 파일 다운로드
	 * 
	 * @param fileId
	 *            - 파일아이디
	 * @param request
	 *            HttpServletRequest
	 * @param response
	 *            HttpServletResponse
	 * @throws Exception
	 */
	@RequestMapping(value = "/common/downloadFile.do")
	public void DownloadFile(@RequestParam(value = "fileId") String fileId,
			HttpServletRequest request, HttpServletResponse response)
			throws Exception {

		FileVO fileVO = new FileVO();
		fileVO.setComFileDtlSeq(fileId);
		FileVO vo = fileService.retrieveComFileDtl(fileVO);

		FileUtil.downloadFile(vo.getFileStreOriNm(), vo.getFileStrePath(),
				vo.getFileStreNm(), request, response, false);
	}
}ageIndex;
	}
	public void setSearchSqPageIndex(int searchSqPageIndex) {
		this.searchSqPageIndex = searchSqPageIndex;
	}
	public int getSearchSqRecordCountPerPage() {
		return searchSqRecordCountPerPage;
	}
	public void setSearchSqRecordCountPerPage(int searchSqRecordCountPerPage) {
		this.searchSqRecordCountPerPage = searchSqRecordCountPerPage;
	}
	public String getParam8() {
		return param8;
	}
	public void setParam8(String param8) {
		this.param8 = param8;
	}
	public int getSearchMasterRecordCountPerPage() {
		return searchMasterRecordCountPerPage;
	}
	public void setSearchMasterRecordCountPerPage(int searchMasterRecordCountPerPage) {
		this.searchMasterRecordCountPerPage = searchMasterRecordCountPerPage;
	}
	public int getSearchPageIndex() {
		return searchPageIndex;
	}
	public void setSearchPageIndex(int searchPageIndex) {
		this.searchPageIndex = searchPageIndex;
	}
	public int getSearchRecordCountPerPage() {
		return searchRecordCountPerPage;
	}
	public void setSearchRecordCountPerPage(int searchRecordCountPerPage) {
		this.searchRecordCountPerPage = searchRecordCountPerPage;
	}
	public String getParam3() {
		return param3;
	}
	public void setParam3(String param3) {
		this.param3 = param3;
	}
	public String getParam4() {
		return param4;
	}
	public void setParam4(String param4) {
		this.param4 = param4;
	}
	public String getParam5() {
		return param5;
	}
	public void setParam5(String param5) {
		this.param5 = param5;
	}


	public String getParam9() {
		return param9;
	}
	public void setParam9(String param9) {
		this.param9 = param9;
	}
	
	public String getParam10() {
		return param10;
	}
	public void setParam10(String param10) {
		this.param10 = param10;
	}
	public String getParam11() {
		return param11;
	}
	public void setParam11(String param11) {
		this.param11 = param11;
	}
	public String getParam12() {
		return param12;
	}
	public void setParam12(String param12) {
		this.param12 = param12;
	}
	public String getParam6() {
		return param6;
	}
	public void setParam6(String param6) {
		this.param6 = param6;
	}
	public String getParam7() {
		return param7;
	}
	
	public void setParam7(String param7) {
		this.param7 = param7;
	}
	public String getSelectedSvcServiceInfoId() {
		return selectedSvcServiceInfoId;
	}
	public void setSelectedSvcServiceInfoId(String selectedSvcServiceInfoId) {
		this.selectedSvcServiceInfoId = selectedSvcServiceInfoId;
	}
	public String getMenuKey() {
		return menuKey;
	}
	public void setMenuKey(String menuKey) {
		this.menuKey = menuKey;
	}
	public String getCallback() {
		return callback;
	}
	public void setCallback(String callback) {
		this.callback = callback;
	}
	public String getParam1() {
		return param1;
	}
	public void setParam1(String param1) {
		this.param1 = param1;
	}
	public String getParam2() {
		return param2;
	}
	public void setParam2(String param2) {
		this.param2 = param2;
	}
	public String getComFileDtlSeq() {
		return comFileDtlSeq;
	}
	public void setComFileDtlSeq(String comFileDtlSeq) {
		this.comFileDtlSeq = comFileDtlSeq;
	}
	public int getComFileSeq() {
		return comFileSeq;
	}
	public void setComFileSeq(int i) {
		this.comFileSeq = i;
	}
	public String getChk() {
		return chk;
	}
	public void setChk(String chk) {
		this.chk = chk;
	}
    
	public String getComFileTempSeq() {
		return comFileTempSeq;
	}
	public void setComFileTempSeq(String comFileTempSeq) {
		this.comFileTempSeq = comFileTempSeq;
	}
    
	public String getSelectedId() {
		return selectedId;
	}

	public void setSelectedId(String selectedId) {
		this.selectedId = selectedId;
	}

	public String getDeleteFileId() {
		return deleteFileId;
	}

	public void setDeleteFileId(String deleteFileId) {
		this.deleteFileId = deleteFileId;
	}

	/**
	 * @return the endDate
	 */
	public String getEndDate() {
		return endDate;
	}

	/**
	 * @param endDate the endDate to set
	 */
	public void setEndDate(String endDate) {
		this.endDate = endDate;
	}

	/**
	 * @return the startDate
	 */
	public String getStartDate() {
		return startDate;
	}

	/**
	 * @param startDate the startDate to set
	 */
	public void setStartDate(String startDate) {
		this.startDate = startDate;
	}
    
    /**
	 * @return the searchCondition
	 */
	public String getSearchCondition() {
		return searchCondition;
	}

	/**
	 * @param searchCondition the searchCondition to set
	 */
	public void setSearchCondition(String searchCondition) {
		this.searchCondition = searchCondition;
	}

	/**
	 * @return the searchKeyword
	 */
	public String getSearchKeyword() {
		return searchKeyword;
	}

	/**
	 * @param searchKeyword the searchKeyword to set
	 */
	public void setSearchKeyword(String searchKeyword) {
		this.searchKeyword = searchKeyword;
	}

	/**
	 * @return the searchUseYn
	 */
	public String getSearchUseYn() {
		return searchUseYn;
	}

	/**
	 * @param searchUseYn the searchUseYn to set
	 */
	public void setSearchUseYn(String searchUseYn) {
		this.searchUseYn = searchUseYn;
	}

	/**
	 * @return the pageIndex
	 */
	public int getPageIndex() {
		return pageIndex;
	}

	/**
	 * @param pageIndex the pageIndex to set
	 */
	public void setPageIndex(int pageIndex) {
		this.pageIndex = pageIndex;
	}

	/**
	 * @return the pageUnit
	 */
	public int getPageUnit() {
		return pageUnit;
	}

	/**
	 * @param pageUnit the pageUnit to set
	 */
	public void setPageUnit(int pageUnit) {
		this.pageUnit = pageUnit;
	}

	/**
	 * @return the pageSize
	 */
	public int getPageSize() {
		return pageSize;
	}

	/**
	 * @param pageSize the pageSize to set
	 */
	public void setPageSize(int pageSize) {
		this.pageSize = pageSize;
	}

	/**
	 * @return the firstIndex
	 */
	public int getFirstIndex() {
		return firstIndex;
	}

	/**
	 * @param firstIndex the firstIndex to set
	 */
	public void setFirstIndex(int firstIndex) {
		this.firstIndex = firstIndex;
	}

	/**
	 * @return the lastIndex
	 */
	public int getLastIndex() {
		return lastIndex;
	}

	/**
	 * @param lastIndex the lastIndex to set
	 */
	public void setLastIndex(int lastIndex) {
		this.lastIndex = lastIndex;
	}

	/**
	 * @return the recordCountPerPage
	 */
	public int getRecordCountPerPage() {
		return recordCountPerPage;
	}

	/**
	 * @param recordCountPerPage the recordCountPerPage to set
	 */
	public void setRecordCountPerPage(int recordCountPerPage) {
		this.recordCountPerPage = recordCountPerPage;
	}

	public String getUploadProcess() {
		return uploadProcess;
	}
	public void setUploadProcess(String uploadProcess) {
		this.uploadProcess = uploadProcess;
	}
	/**
	 * VO를 문자열로 변환한다.
	 * 
	 * @return 문자열
	 */
	public String toString() {
        return ToStringBuilder.reflectionToString(this);
    }

	/**
	 * VO를 XML로 변환한다.
	 * @return XML
	 */
    public String toXml() {
    	StringBuffer xmlBuffer = new StringBuffer();
    	
    	Method[] methodArray = this.getClass().getMethods();
    	
    	String fieldName;
    	Object dataObj;
    	String data = null;
    	Method method;
    	@SuppressWarnings("rawtypes")
		Class type;
    	
		for (int i = 0; i < methodArray.length; i++) {
			try {
				method = methodArray[i];
				type = method.getReturnType();
				
				if( method.getModifiers()==Modifier.PUBLIC && method.getName().startsWith("get") ) {
					fieldName = this.getFieldName(method.getName());
					xmlBuffer.append("<").append(fieldName).append(">");
					
					// Number
					if( type.isPrimitive() || type==Short.class || type==Integer.class || type==Long.class ||
						type==Float.class || type==Double.class || type == BigDecimal.class) {
						dataObj = method.invoke(this, new Object[]{});
						
						if(dataObj!=null) {
							data = dataObj.toString();
						}
						
						if(data==null) {
							xmlBuffer.append("");
						} else if("0.0".equals(data)) {
							xmlBuffer.append("0");
						} else {
							// *.0
							if(data.endsWith(".0")) {
								xmlBuffer.append(data.substring(0, data.indexOf("."))); // .0 제거
							} else {
								xmlBuffer.append(data);
							}
						}
					}
					// String
					else if( type == String.class ) {
						data = (String)method.invoke(this, new Object[]{});
						
						if(data==null) data = "";
						
						xmlBuffer.append("<![CDATA[").append(data).append("]]>");
					}
					
					xmlBuffer.append("</").append(fieldName).append(">");
				}
			} catch (Exception e) {
				e.printStackTrace();
			}
		}
		
    	return xmlBuffer.toString();
    }
    
    private String getFieldName(String methodName) {
    	// get 제거, 첫문자 소문자 처리
    	String fieldName = methodName.substring(3,4).toLowerCase() + methodName.substring(4);
    	
    	return fieldName;
    }
	public void setMenuUrl(String menuUrl) {
		this.menuUrl = menuUrl;
	}
	public String getMenuUrl() {
		return menuUrl;
	}
    
}
