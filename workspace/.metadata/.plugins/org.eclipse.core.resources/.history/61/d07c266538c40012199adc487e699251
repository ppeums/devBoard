<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="PayMentHistory">

	<typeAlias alias="moneyVO" type="kr.co.sinsul.common.vo.MoneyVO"/>

	<resultMap id="paymentHistoryListMap" class="moneyVO">
		<result property="rn" column="RN"/>
		<result property="moneyId" column="MONEY_ID"/>
		<result property="moneyTradedt" column="MONEY_TRADEDT"/>
		<result property="moneyWithdraw" column="MONEY_WITHDRAW"/>
		<result property="moneyDeposit" column="MONEY_DEPOSIT"/>
		<result property="moneyBalance" column="MONEY_BALANCE"/>
		<result property="moneyDesc" column="MONEY_DESC"/>
		<result property="moneyAcnumtage" column="MONEY_ACNUMTAGE"/>
		<result property="moneyBanktage" column="MONEY_BANKTAGE"/>
		<result property="moneyGubun" column="MONEY_GUBUN"/>
	</resultMap>

	<select id="paymentHistoryDAO.selectPaymentHistoryList" parameterClass="moneyVO" resultMap="paymentHistoryListMap">
		/** 계좌내역을 조회한다. (paymentHistoryDAO.selectPaymentHistoryList) **/
		SELECT * FROM ( SELECT ROWNUM RN, TB.* FROM (
			SELECT	*
			FROM	
			(
				SELECT	MONEY_ID        /** 시퀀스 아이디 **/ 
				,		MONEY_TRADEDT	/** 거래일자 **/
				,		MONEY_WITHDRAW	/** 출금액 **/
				,		MONEY_DEPOSIT	/** 입금액 **/
				,		MONEY_BALANCE	/** 잔액 **/
				,		MONEY_DESC		/** 거래내용 **/
				,		MONEY_ACNUMTAGE	/** 상대계좌번호 **/
				,		MONEY_BANKTAGE	/** 상대은행 **/
				,		MONEY_GUBUN		/** 거래구분 **/
				FROM    TB_MONEY
			<isNotEmpty property="startDate">
				WHERE	MONEY_TRADEDT BETWEEN TO_DATE(#startDate# || '000000', 'YYYYMMDDHH24MISS') AND TO_DATE(#endDate# || '235959', 'YYYYMMDDHH24MISS') 
			</isNotEmpty>
				ORDER BY MONEY_TRADEDT ASC
			)
			ORDER BY MONEY_TRADEDT DESC
		) TB ) WHERE RN BETWEEN #firstIndex# + 1 AND #firstIndex# + #recordCountPerPage#			
	</select>
	
	<select id="paymentHistoryDAO.selectPaymentHistoryListCount" parameterClass="moneyVO" resultClass="java.lang.Integer">
		/** 계좌내역 건수를 조회한다. (paymentHistoryDAO.selectPaymentHistoryListCount) **/
		SELECT	COUNT(MONEY_ID) AS CNT 
		FROM    TB_MONEY
		<isNotEmpty property="startDate">
		WHERE	MONEY_TRADEDT BETWEEN TO_DATE(#startDate# || '000000', 'YYYYMMDDHH24MISS') AND TO_DATE(#endDate# || '235959', 'YYYYMMDDHH24MISS') 
		</isNotEmpty>
	</select>
	
</sqlMap>
